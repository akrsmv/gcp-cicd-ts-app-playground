version: '3.7'

services:
  web:
    platform: linux/amd64
    image: gctapp/web
    container_name: gctapp-web
    ports:
      - 18080:8080
    build:
      context: .
      dockerfile: ./.docker/images/web/Dockerfile
      args:
        REACT_APP_GCT_ENV: LOCALDOCKER
      # target: gctapp-web-dev
    extra_hosts:
      - "host.docker.internal:host-gateway"

  api:
    image: gctapp/api
    container_name: gctapp-api
    build:
      context: .
      dockerfile: ./.docker/images/api/Dockerfile
      # target: gctapp-api-dev
    ports:
      - 28080:8080
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - GCT_ENV=LOCAL
      - PORT=8080
      - REDIS_CONNECTION_STRING=redis://gctapp-redis:6379

  redis:
    image: redis/redis-stack
    container_name: gctapp-redis
    ports:
      - 6379:6379
    extra_hosts:
      - "host.docker.internal:host-gateway"
